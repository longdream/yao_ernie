<!DOCTYPE html>
<html>
<head>
    <title>SSE æµ‹è¯•</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>SSE è¿›åº¦æµ‹è¯•</h1>
    <div id="status">ç­‰å¾…è¿æ¥...</div>
    <div id="messages"></div>
    
    <script>
        const sessionId = `session_${Date.now()}`;
        console.log('Session ID:', sessionId);
        
        const eventSource = new EventSource(`http://localhost:8765/agent/progress/${sessionId}`);
        
        eventSource.onopen = () => {
            document.getElementById('status').textContent = 'âœ… SSE è¿æ¥å·²å»ºç«‹';
            console.log('SSE è¿æ¥å·²å»ºç«‹');
        };
        
        eventSource.onmessage = (event) => {
            const data = JSON.parse(event.data);
            console.log('æ”¶åˆ°æ¶ˆæ¯:', data);
            
            const messagesDiv = document.getElementById('messages');
            const p = document.createElement('p');
            p.textContent = JSON.stringify(data, null, 2);
            messagesDiv.appendChild(p);
            
            if (data.done || data.timeout) {
                document.getElementById('status').textContent = 'ğŸ è¿æ¥å·²å…³é—­';
                eventSource.close();
            }
        };
        
        eventSource.onerror = (error) => {
            console.error('SSE é”™è¯¯:', error);
            document.getElementById('status').textContent = 'âŒ è¿æ¥é”™è¯¯';
        };
        
        // 10ç§’åå‘é€ä¸€ä¸ªæµ‹è¯•è¯·æ±‚
        setTimeout(async () => {
            console.log('å‘é€æµ‹è¯•è¯·æ±‚...');
            const response = await fetch('http://localhost:8765/agent/execute', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    app_name: 'æµ‹è¯•',
                    prompt: 'æµ‹è¯•æ¶ˆæ¯',
                    session_id: sessionId
                })
            });
            const result = await response.json();
            console.log('å“åº”:', result);
        }, 2000);
    </script>
</body>
</html>

